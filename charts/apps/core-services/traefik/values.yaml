# https://github.com/traefik/traefik-helm-chart/blob/master/traefik/values.yaml
namespace: core-services
primaryDomain: <path:kv/data/domains#primaryDomain>
letsencryptPath: <path:kv/data/hostPath#appdata>/core-services/letsencrypt
traefik:
  namespaceOverride: core-services
  deployment: 
    revisionHistoryLimit: 1
  podSecurityContext:
    runAsGroup: 1000
    runAsUser: 1000
  providers:
    kubernetesCRD:
      allowCrossNamespace: true
    kubernetesIngress:
      publishedService:
        enabled: true
  service:
    spec:
      externalTrafficPolicy: Local
  ports:
    traefik:
      exposedPort: 8082
      expose:
        default: true
    web:
      redirectTo: 
        port: websecure
  certResolvers: 
    letsencrypt:
      email: <path:kv/data/core-services/traefik#email>
      httpChallenge:
        entryPoint: "web"
      dnsChallenge:
        provider: cloudflare
      storage: /letsencrypt/acme.json
    local:
      email: <path:kv/data/core-services/traefik#email>
      storage: /letsencrypt/local.json
      dnsChallenge:
        provider: rfc2136
  env:
    - name: CF_DNS_API_TOKEN
      valueFrom:
        secretKeyRef:
          name: traefik
          key: CF_DNS_API_TOKEN
    - name: RFC2136_NAMESERVER
      value: "10.43.0.30:53"
    - name: RFC2136_TSIG_KEY
      value: tsig-secret
    - name: RFC2136_TSIG_ALGORITHM
      value: hmac-sha256.
    - name: RFC2136_TSIG_SECRET
      value: <path:kv/data/core-services/traefik#RFC2136_TSIG_SECRET>
  persistence:
    enabled: true
    name: letsencrypt
    path: /letsencrypt
    storageClass: manual
  ingressRoute:
    dashboard:
      enabled: true
  logs:
    access:
      enabled: true
      fields:
        headers: 
          defaultmode: keep
  experimental:
    plugins:
      bouncer:
        moduleName: github.com/maxlerebourg/crowdsec-bouncer-traefik-plugin
        version: v1.3.3