apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-namespace-overview
  namespace: {{ .Values.namespace }}
  labels:
    grafana_dashboard: "1"
data:
  namespace-overview.json: |
    {
      "annotations": {"list": []},
      "description": "Aggregated CPU, Memory and Network per namespace (app-of-apps)",
      "editable": true,
      "graphTooltip": 1,
      "links": [],
      "panels": [

        { "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0},   "id": 1,  "title": "AI Services",       "type": "row" },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "short", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 0, "y": 1}, "id": 2,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"ai-services\",container!=\"POD\",container!=\"\"}[2m]))", "legendFormat": "cpu", "refId": "A"}],
          "title": "CPU", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "bytes", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 8, "y": 1}, "id": 3,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(container_memory_working_set_bytes{namespace=\"ai-services\",container!=\"POD\",container!=\"\"})", "legendFormat": "memory", "refId": "A"}],
          "title": "Memory", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 5}, "unit": "Bps", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 16, "y": 1}, "id": 4,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_receive_bytes_total{namespace=\"ai-services\"}[2m]))", "legendFormat": "rx", "refId": "A"},
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_transmit_bytes_total{namespace=\"ai-services\"}[2m]))", "legendFormat": "tx", "refId": "B"}
          ],
          "title": "Network", "type": "timeseries"
        },

        { "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 9},   "id": 10, "title": "Core Services",     "type": "row" },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "short", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 0, "y": 10}, "id": 11,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"core-services\",container!=\"POD\",container!=\"\"}[2m]))", "legendFormat": "cpu", "refId": "A"}],
          "title": "CPU", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "bytes", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 8, "y": 10}, "id": 12,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(container_memory_working_set_bytes{namespace=\"core-services\",container!=\"POD\",container!=\"\"})", "legendFormat": "memory", "refId": "A"}],
          "title": "Memory", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 5}, "unit": "Bps", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 16, "y": 10}, "id": 13,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_receive_bytes_total{namespace=\"core-services\"}[2m]))", "legendFormat": "rx", "refId": "A"},
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_transmit_bytes_total{namespace=\"core-services\"}[2m]))", "legendFormat": "tx", "refId": "B"}
          ],
          "title": "Network", "type": "timeseries"
        },

        { "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 18},  "id": 20, "title": "Game Servers",      "type": "row" },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "short", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 0, "y": 19}, "id": 21,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"game-servers\",container!=\"POD\",container!=\"\"}[2m]))", "legendFormat": "cpu", "refId": "A"}],
          "title": "CPU", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "bytes", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 8, "y": 19}, "id": 22,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(container_memory_working_set_bytes{namespace=\"game-servers\",container!=\"POD\",container!=\"\"})", "legendFormat": "memory", "refId": "A"}],
          "title": "Memory", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 5}, "unit": "Bps", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 16, "y": 19}, "id": 23,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_receive_bytes_total{namespace=\"game-servers\"}[2m]))", "legendFormat": "rx", "refId": "A"},
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_transmit_bytes_total{namespace=\"game-servers\"}[2m]))", "legendFormat": "tx", "refId": "B"}
          ],
          "title": "Network", "type": "timeseries"
        },

        { "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 27},  "id": 30, "title": "Home Automation",   "type": "row" },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "short", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 0, "y": 28}, "id": 31,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"home-automation\",container!=\"POD\",container!=\"\"}[2m]))", "legendFormat": "cpu", "refId": "A"}],
          "title": "CPU", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "bytes", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 8, "y": 28}, "id": 32,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(container_memory_working_set_bytes{namespace=\"home-automation\",container!=\"POD\",container!=\"\"})", "legendFormat": "memory", "refId": "A"}],
          "title": "Memory", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 5}, "unit": "Bps", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 16, "y": 28}, "id": 33,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_receive_bytes_total{namespace=\"home-automation\"}[2m]))", "legendFormat": "rx", "refId": "A"},
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_transmit_bytes_total{namespace=\"home-automation\"}[2m]))", "legendFormat": "tx", "refId": "B"}
          ],
          "title": "Network", "type": "timeseries"
        },

        { "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 36},  "id": 40, "title": "Media Management",  "type": "row" },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "short", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 0, "y": 37}, "id": 41,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"media-management\",container!=\"POD\",container!=\"\"}[2m]))", "legendFormat": "cpu", "refId": "A"}],
          "title": "CPU", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "bytes", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 8, "y": 37}, "id": 42,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(container_memory_working_set_bytes{namespace=\"media-management\",container!=\"POD\",container!=\"\"})", "legendFormat": "memory", "refId": "A"}],
          "title": "Memory", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 5}, "unit": "Bps", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 16, "y": 37}, "id": 43,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_receive_bytes_total{namespace=\"media-management\"}[2m]))", "legendFormat": "rx", "refId": "A"},
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_transmit_bytes_total{namespace=\"media-management\"}[2m]))", "legendFormat": "tx", "refId": "B"}
          ],
          "title": "Network", "type": "timeseries"
        },

        { "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 45},  "id": 50, "title": "Utility Services",  "type": "row" },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "short", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 0, "y": 46}, "id": 51,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"utility-services\",container!=\"POD\",container!=\"\"}[2m]))", "legendFormat": "cpu", "refId": "A"}],
          "title": "CPU", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "bytes", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 8, "y": 46}, "id": 52,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(container_memory_working_set_bytes{namespace=\"utility-services\",container!=\"POD\",container!=\"\"})", "legendFormat": "memory", "refId": "A"}],
          "title": "Memory", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 5}, "unit": "Bps", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 16, "y": 46}, "id": 53,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_receive_bytes_total{namespace=\"utility-services\"}[2m]))", "legendFormat": "rx", "refId": "A"},
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_transmit_bytes_total{namespace=\"utility-services\"}[2m]))", "legendFormat": "tx", "refId": "B"}
          ],
          "title": "Network", "type": "timeseries"
        },

        { "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 54},  "id": 60, "title": "Monitoring",         "type": "row" },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "short", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 0, "y": 55}, "id": 61,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"monitoring\",container!=\"POD\",container!=\"\"}[2m]))", "legendFormat": "cpu", "refId": "A"}],
          "title": "CPU", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 10}, "unit": "bytes", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 8, "y": 55}, "id": 62,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [{"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(container_memory_working_set_bytes{namespace=\"monitoring\",container!=\"POD\",container!=\"\"})", "legendFormat": "memory", "refId": "A"}],
          "title": "Memory", "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"lineWidth": 2, "fillOpacity": 5}, "unit": "Bps", "min": 0}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 16, "y": 55}, "id": 63,
          "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_receive_bytes_total{namespace=\"monitoring\"}[2m]))", "legendFormat": "rx", "refId": "A"},
            {"datasource": {"type": "prometheus", "uid": "${datasource}"}, "expr": "sum(rate(container_network_transmit_bytes_total{namespace=\"monitoring\"}[2m]))", "legendFormat": "tx", "refId": "B"}
          ],
          "title": "Network", "type": "timeseries"
        }

      ],
      "schemaVersion": 38,
      "tags": ["overview", "kubernetes"],
      "templating": {
        "list": [
          {
            "current": {},
            "hide": 0,
            "includeAll": false,
            "multi": false,
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "type": "datasource"
          }
        ]
      },
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "browser",
      "title": "Namespace Overview",
      "uid": "namespace-overview",
      "version": 1
    }
